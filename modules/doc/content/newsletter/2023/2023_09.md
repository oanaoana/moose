# MOOSE Newsletter (September 2023)

## MOOSE Improvements

### Nearest-point layered side integrals for functors

[NearestPointLayeredSideIntegralFunctor.md] was added, which extends
[NearestPointLayeredSideIntegral.md] to accept any [functor](Functors/index.md),
not just variables.

### JSON reader

The [JSONFileReader.md] user object lets a user load a JSON file in their simulation. Other objects can then
access data stored in the JSON tree, as long as they use the right key, or successive keys, to access the JSON tree.
This is demonstrated by new functionalities on the piecewise tabular functions, including [PiecewiseConstant.md] and
[PiecewiseLinear.md] that can load the X and Y coordinates for the 1D function from vectors stored in a JSON file.

### Mesh diagnostics

Mesh diagnostics were introduced in the mesh generation phase using the [MeshDiagnosticsGenerator.md]. This was driven by
the need to catch errors in externally produced meshes before the simulation.
The following diagnostics are implemented, and one can check:

- the element volumes, making sure they are all positive, and all larger or smaller than user-defined values
- the element and the element sides' Jacobians for a 5th order quadrature. Negative Jacobians are a common issue with
  distorted meshes
- sideset orientations, notably to make sure that the orientation is consistent with regards to subdomains, and does not flip
  from one element side to another
- whether any elements overlap. This is achieved by checking both the element nodes and the element centroids, making sure they
  are not placed within another element they do not belong in. These two checks are heuristics.
- whether multiple types of elements are present in the same subdomain. A single element type per subdomain is a limitation of
  the Exodus output, so it is best to avoid it.
- side planarity. Non planar sides are approximated by the ray tracing module, so it may be important to be aware of their existence
- whether there are any non-conformalities, with nodes from one element touching another one but not being part of it.
  The special case of non-conformalities arising from uniform adaptive mesh refinement is also detected and singled-out.


### Mesh Generation new capabilities

Helical extrusion capabilities were added in the [AdvancedExtruderGenerator.md]. By specifying a non-zero axial pitch for the
rotation, the 2D mesh is rotated during the extrusion. A full rotation, 2 pi radians, is performed over a full axial pitch of extrusion.

A [ParsedElementDeletionGenerator.md] object was added to be able to delete elements based on their spatial location, their id
or their volume. Those criteria can be combined at leisure using a parsed expression in the [!param](/Mesh/ParsedElementDeletionGenerator/expression)
parameter. For example: `expression = 'x > 0.1 | (id=345 & volume > 1)' will delete all elements with a centroid beyond x=1,
and the element of id 345 if its volume is above 1.

### Navier Stokes module improvements

The [NSFVPressurePin.md] user object was added to the module. It provides the same functionality as the previous
average and point-value constraints on the pressure, but as a post-treatment of the pressure field rather than a
constraint during the nonlinear solve. This facilitates preconditioning because the lagrange multiplier for the constraint
had a zero on the diagonal of the Jacobian.

## libMesh-level Changes

## PETSc-level Changes

### PETSc updated to 3.19.3: new conda packages

The `moose-petsc` package has been updated alongside the repository submodule to 3.19.3 -
specifically, a pre-release version (3.19.3-884-g08c1f94318e). As a result of this change, `moose-mpich`
required a new pinned dependency, GNU `bison` version 3.4. Subsequently, all conda packages have been
incremented and should be updated.

To update your MOOSE packages, please activate your MOOSE conda environment and
perform the command:

```
mamba update --all
```

The following package versions and builds outlined in the update prompt should be
at least the following:

```
Package                  Version                     Build
============================================================
moose-dev                2023.09.15                  build_0
moose-libmesh            2023.09.06                  build_2
moose-libmesh-vtk        9.2.6                       build_4
moose-petsc              3.19.3.884.g08c1f94318e     build_0
moose-mpich              4.0.2                       build_11
moose-peacock            2023.09.15                  build_0
```

## Bug Fixes and Minor Enhancements

- An issue with the conflicting value diagnostic was patched in nearest-node transfers. Turning on the diagnostic,
  which was a default, could influence results in parallel.
- Positions, used to create multiapps, can now be created by evaluating Functors, using the [FunctorPositions.md] object
- Initial conditions and restart and now flagged as a potential user mistake. To combine them, and let initial conditions
  override the restarted fields, you will need to pass the `allow_initial_conditions_with_restart` parameter in the `[Problem]` block.
- The `moose-language-support` plugin has been updated. It now highlights all known block syntaxes in MOOSE and its modules. It also
  features additional snippets for coding finite volume objects that can be accessed through auto-completion.
- The UNITY build has been extended to all but a few source files. For fast machines with low core counts, the expected build speed-up
  of the framework standalone is around 25%.
- The [FunctorSmoother.md] functor material has been introduced to smooth out discontinuous or checkerboarding
  fields. As it acts on a functor, it can handle functions, functor material properties and variables.
